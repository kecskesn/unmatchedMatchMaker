<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="src/css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head>

<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <a class="btn btn-primary" id="heroStatBtn" data-url="heroStat"><i class="fas fa-chart-bar"></i></a>
            <a class="btn btn-primary" id="cardTrackerBtn" data-url="cardTracker"><i
                    class="fas fa-layer-group"></i></a>
            <a class="btn btn-primary" id="matchLoggerBtn" data-url="matchLogger"><i class="fas fa-file-alt"></i></a>
            <a class="btn btn-primary active" id="playerStatsBtn" data-url="playerStats"><i
                    class="fas fa-users"></i></a>
        </div>

        <div class="mt-4">
            <div class="row justify-content-center">
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Bal치zs</h5>
                            <p class="card-text mb-3" id="balazsWins">Wins: -</p>
                            <div class="card-subtitle mb-3">Top 3 Most Played Heroes</div>
                            <ul class="list-group list-group-flush" id="balazsTopHeroes">
                            </ul>
                            <div class="card-subtitle mb-3">Top 3 Highest Win Rate Heroes</div>
                            <ul class="list-group list-group-flush" id="balazsTopWinRate">
                            </ul>
                            <div class="card-subtitle mb-3">Worst Win Rate Hero</div>
                            <ul class="list-group list-group-flush" id="balazsWorstWinRate">
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Keca</h5>
                            <p class="card-text mb-3" id="kecaWins">Wins: -</p>
                            <div class="card-subtitle mb-3">Top 3 Most Played Heroes</div>
                            <ul class="list-group list-group-flush" id="kecaTopHeroes">
                            </ul>
                            <div class="card-subtitle mb-3">Top 3 Highest Win Rate Heroes</div>
                            <ul class="list-group list-group-flush" id="kecaTopWinRate">
                            </ul>
                            <div class="card-subtitle mb-3">Worst Win Rate Hero</div>
                            <ul class="list-group list-group-flush" id="kecaWorstWinRate">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const heroStatBtn = document.getElementById("heroStatBtn");
        const cardTrackerBtn = document.getElementById("cardTrackerBtn");
        const matchLoggerBtn = document.getElementById("matchLoggerBtn");
        const playerStatsBtn = document.getElementById("playerStatsBtn");

        heroStatBtn.addEventListener("click", handleButtonClick);
        cardTrackerBtn.addEventListener("click", handleButtonClick);
        matchLoggerBtn.addEventListener("click", handleButtonClick);
        playerStatsBtn.addEventListener("click", handleButtonClick);

        function handleButtonClick() {
            const baseUrl = this.getAttribute("data-url");
            const urlParams = new URLSearchParams(window.location.search);
            const newUrl = `${baseUrl}?${urlParams.toString()}`;
            window.location.href = newUrl;
        }

        async function playerTopHeroStats() {
            try {
                const response = await fetch('/playerTopHeroStats');
                const playerStatsResult = await response.json();
                console.log(playerStatsResult);

                const formatHeroStats = (hero) => `${hero.name} - Plays: ${hero.plays}, Win Rate: ${hero.winRate}%`;

                const balazsTopHeroes = document.getElementById("balazsTopHeroes");
                playerStatsResult.Bal치zs.slice(0, 3).forEach(hero => {
                    const listItem = document.createElement("li");
                    listItem.classList.add("list-group-item");
                    listItem.textContent = formatHeroStats(hero);
                    balazsTopHeroes.appendChild(listItem);
                });

                const kecaTopHeroes = document.getElementById("kecaTopHeroes");
                playerStatsResult.Keca.slice(0, 3).forEach(hero => {
                    const listItem = document.createElement("li");
                    listItem.classList.add("list-group-item");
                    listItem.textContent = formatHeroStats(hero);
                    kecaTopHeroes.appendChild(listItem);
                });

                // Find top 3 highest win rate heroes
                const balazsTopWinRate = document.getElementById("balazsTopWinRate");
                playerStatsResult.Bal치zs
                    .filter(hero => hero.plays >= 2)
                    .sort((a, b) => b.winRate - a.winRate)
                    .slice(0, 3)
                    .forEach(hero => {
                        const listItem = document.createElement("li");
                        listItem.classList.add("list-group-item");
                        listItem.textContent = formatHeroStats(hero);
                        balazsTopWinRate.appendChild(listItem);
                    });

                const kecaTopWinRate = document.getElementById("kecaTopWinRate");
                playerStatsResult.Keca
                    .filter(hero => hero.plays >= 2)
                    .sort((a, b) => b.winRate - a.winRate)
                    .slice(0, 3)
                    .forEach(hero => {
                        const listItem = document.createElement("li");
                        listItem.classList.add("list-group-item");
                        listItem.textContent = formatHeroStats(hero);
                        kecaTopWinRate.appendChild(listItem);
                    });

                // Find worst win rate hero
                const findWorstWinRateHero = (heroes) => {
                    const eligibleHeroes = heroes.filter(hero => hero.plays >= 2);
                    if (eligibleHeroes.length === 0) return "-";
                    return eligibleHeroes.reduce((prev, curr) => prev.winRate < curr.winRate ? prev : curr);
                };

                const balazsWorstWinRate = document.getElementById("balazsWorstWinRate");
                const balazsWorstHero = findWorstWinRateHero(playerStatsResult.Bal치zs);
                const balazsWorstWinRateItem = document.createElement("li");
                balazsWorstWinRateItem.classList.add("list-group-item");
                balazsWorstWinRateItem.textContent = formatHeroStats(balazsWorstHero);
                balazsWorstWinRate.appendChild(balazsWorstWinRateItem);

                const kecaWorstWinRate = document.getElementById("kecaWorstWinRate");
                const kecaWorstHero = findWorstWinRateHero(playerStatsResult.Keca);
                const kecaWorstWinRateItem = document.createElement("li");
                kecaWorstWinRateItem.classList.add("list-group-item");
                kecaWorstWinRateItem.textContent = formatHeroStats(kecaWorstHero);
                kecaWorstWinRate.appendChild(kecaWorstWinRateItem);

            } catch (error) {
                console.error('Error fetching player stats:', error);
            }
        }

        window.onload = function () {
            updateWinRateTracker();
            playerTopHeroStats();
        };
    </script>
</body>

</html>